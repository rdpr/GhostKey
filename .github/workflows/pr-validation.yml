name: PR Validation

on:
  pull_request:
    types: [opened, edited, synchronize, reopened]

permissions:
  contents: read
  pull-requests: write

jobs:
  validate-pr-title:
    runs-on: ubuntu-latest
    
    steps:
    - name: Validate PR title
      uses: amannn/action-semantic-pull-request@v5
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        types: |
          feat
          fix
          docs
          style
          refactor
          perf
          test
          chore
          ci
          build
          revert
        requireScope: false
        subjectPattern: ^(?![A-Z]).+$
        subjectPatternError: |
          The subject "{subject}" found in the pull request title "{title}"
          didn't match the configured pattern. Please ensure that the subject
          doesn't start with an uppercase character.
        ignoreLabels: |
          dependencies
          bot
        validateSingleCommit: false
        validateSingleCommitMatchesPrTitle: false
    
    - name: Comment on invalid PR title
      if: failure()
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: `## ‚ùå Invalid PR Title

          Your PR title doesn't follow the [Conventional Commits](https://www.conventionalcommits.org/) format.

          ### Required Format
          \`\`\`
          <type>(<scope>): <description>
          <type>(<scope>)!: <breaking change description>
          \`\`\`

          ### Valid Types
          - **feat**: A new feature
          - **fix**: A bug fix
          - **docs**: Documentation changes
          - **style**: Code style changes (formatting, etc.)
          - **refactor**: Code refactoring
          - **perf**: Performance improvements
          - **test**: Adding or updating tests
          - **chore**: Maintenance tasks
          - **ci**: CI/CD changes
          - **build**: Build system changes
          - **revert**: Reverting a previous commit

          ### Examples
          - \`feat: add dark mode support\`
          - \`fix: resolve crash on startup\`
          - \`docs: update installation guide\`
          - \`feat(ui): implement new welcome screen\`
          - \`fix(auth): correct token validation\`
          - \`feat!: redesign entire UI (breaking change)\`
          - \`fix(api)!: change response format (breaking)\`

          ### Breaking Changes
          - Add \`!\` after the type/scope to indicate a breaking change
          - Example: \`feat!: breaking change\` or \`feat(scope)!: breaking change\`
          - The \`!\` is placed before the \`:\`

          ### Rules
          - Scope is optional (e.g., \`feat: ...\` or \`feat(scope): ...\`)
          - Description should start with lowercase
          - Use present tense ("add" not "added")
          - Be concise and descriptive

          Please update your PR title to match this format. The check will automatically re-run.`
          })


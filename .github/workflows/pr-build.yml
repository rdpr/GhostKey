name: PR Build Check

on:
  pull_request:
    branches:
      - main
      - dev
    paths-ignore:
      - '**.md'
      - '.gitignore'
      - 'LICENSE'

jobs:
  build:
    runs-on: macos-14
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Setup Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: latest-stable
    
    - name: Build app
      run: |
        echo "ðŸ”¨ Building GhostKey..."
        xcodebuild clean build \
          -project GhostKey.xcodeproj \
          -scheme GhostKey \
          -configuration Debug \
          -derivedDataPath ./build \
          CODE_SIGN_IDENTITY="" \
          CODE_SIGNING_REQUIRED=NO \
          CODE_SIGNING_ALLOWED=NO
        
        echo "âœ… Build successful"
    
    - name: Check for app bundle
      run: |
        APP_PATH=$(find ./build -name "GhostKey.app" -type d | head -n 1)
        
        if [ -z "$APP_PATH" ]; then
          echo "âŒ GhostKey.app not found"
          exit 1
        fi
        
        echo "âœ… App bundle found at: $APP_PATH"
    
    - name: Build summary
      run: |
        echo "## âœ… Build Successful!" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "The app builds successfully and is ready for merge." >> $GITHUB_STEP_SUMMARY

